# åŸºäº pnpm monorepo é¡¹ç›®å·¥ç¨‹åŒ–è®¾è®¡

## è¿‡å¾€é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡ monorepo æ¶æ„æ–¹æ¡ˆï¼ŸğŸ¤”

### ä¼ ç»Ÿæ¶æ„æ¦‚è¿°

**ä»€ä¹ˆæ˜¯ä¼ ç»Ÿæ¶æ„ï¼Ÿ**

| ç‰¹ç‚¹             | è¯´æ˜                                       |
| :--------------- | :----------------------------------------- |
| **ç‹¬ç«‹é¡¹ç›®ç»“æ„** | æ¯ä¸ªé¡¹ç›®ä½œä¸ºç‹¬ç«‹çš„å•å…ƒå¼€å‘ã€ç»´æŠ¤å’Œéƒ¨ç½²     |
| **æŠ€æœ¯æ ˆç‹¬ç«‹**   | ä¸åŒçš„é¡¹ç›®å¯èƒ½ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆå’Œå·¥å…·é“¾     |
| **ä¾èµ–ç®¡ç†**     | æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ç‹¬ç«‹çš„`node_modules`å’Œä¾èµ–é…ç½® |
| **éƒ¨ç½²ç­–ç•¥**     | å„è‡ªç‹¬ç«‹éƒ¨ç½²å’Œä¸Šçº¿ï¼Œé€šå¸¸ä¾èµ– CI/CD å·¥å…·    |

**ä¼ ç»Ÿæ¶æ„çš„ä¼˜ç¼ºç‚¹**

| ä¼˜ç‚¹                                                   | ç¼ºç‚¹                                                           |
| :----------------------------------------------------- | :------------------------------------------------------------- |
| **å¼€å‘ç‹¬ç«‹æ€§**ï¼šå„å›¢é˜Ÿæˆ–é¡¹ç›®äº’ç›¸éš”ç¦»ï¼Œç‹¬ç«‹å¼€å‘äº’ä¸å½±å“ | **ä»£ç é‡å¤**ï¼šå¤šä¸ªé¡¹ç›®ä¸­å¯èƒ½å­˜åœ¨é‡å¤ä»£ç æˆ–æ¨¡å—ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†   |
| **çµæ´»æ€§é«˜**ï¼šå¯ä»¥æ ¹æ®ä¸åŒé¡¹ç›®éœ€æ±‚é€‰æ‹©æœ€ä½³æŠ€æœ¯æ ˆ       | **ä¾èµ–ç‰ˆæœ¬å†²çª**ï¼šå¤šä¸ªé¡¹ç›®ç»´æŠ¤ç›¸åŒä¾èµ–çš„ä¸åŒç‰ˆæœ¬ï¼Œå®¹æ˜“å‡ºç°å†²çª |
|                                                        | **åä½œæˆæœ¬é«˜**ï¼šè·¨é¡¹ç›®çš„è”è°ƒå’ŒåŠŸèƒ½å…±äº«éœ€è¦é¢å¤–çš„æ²Ÿé€šå’Œç®¡ç†     |
|                                                        | **æ„å»ºæ•ˆç‡ä½**ï¼šæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹æ„å»ºï¼Œå¯¼è‡´æ—¶é—´æµªè´¹                 |

### pnpm monorepo æ¶æ„æ¦‚è¿°

**ä»€ä¹ˆæ˜¯ monorepoï¼Ÿ**

| ç‰¹ç‚¹               | è¯´æ˜                                                                 |
| :----------------- | :------------------------------------------------------------------- |
| **å•ä¸€ä»£ç ä»“åº“**   | å°†å¤šä¸ªç›¸å…³é¡¹ç›®ï¼ˆå­åŒ…ï¼‰é›†ä¸­åœ¨åŒä¸€ä¸ªä»£ç ä»“åº“ä¸­è¿›è¡Œç®¡ç†                 |
| **ç»Ÿä¸€ç®¡ç†ä¾èµ–**   | é€šè¿‡å·¥å…·ï¼ˆå¦‚ pnpmã€Lernaã€Turborepo ç­‰ï¼‰å®ç°ä¾èµ–çš„ç»Ÿä¸€å®‰è£…å’Œç‰ˆæœ¬ç®¡ç† |
| **å…±äº«ä»£ç **       | é€šè¿‡å·¥ä½œç©ºé—´æˆ–å†…éƒ¨åŒ…æœºåˆ¶å…±äº«å…¬å…±æ¨¡å—                                 |
| **ç»Ÿä¸€æ„å»ºå’Œå‘å¸ƒ** | å¯ä»¥å¯¹å¤šä¸ªå­åŒ…è¿›è¡Œä¸€æ¬¡æ€§æ„å»ºå’Œå‘å¸ƒ                                   |

**ä¸ºä»€ä¹ˆé€‰æ‹© pnpmï¼Ÿ**

| ç‰¹ç‚¹                  | è¯´æ˜                                               |
| :-------------------- | :------------------------------------------------- |
| **é“¾æ¥æœºåˆ¶é«˜æ•ˆ**      | pnpm ä½¿ç”¨ç¬¦å·é“¾æ¥ä»£æ›¿ç›´æ¥å®‰è£…ï¼Œå‡å°‘é‡å¤çš„ä¾èµ–å®‰è£…  |
| **æ›´å¿«çš„å®‰è£…é€Ÿåº¦**    | pnpm çš„ç¼“å­˜æœºåˆ¶ä½¿å¾—å®‰è£…ä¾èµ–é€Ÿåº¦æ›´å¿«                |
| **åŸç”Ÿæ”¯æŒ monorepo** | æ”¯æŒå·¥ä½œç©ºé—´ï¼ˆworkspacesï¼‰é…ç½®ï¼Œæ–¹ä¾¿å­åŒ…é—´ä¾èµ–ç®¡ç† |
| **ç£ç›˜å ç”¨æ›´å°‘**      | é€šè¿‡å»é‡æœºåˆ¶å¤§å¹…å‡å°‘ç£ç›˜ä½¿ç”¨é‡                     |

### æ¶æ„æ¼”è¿›è¿‡ç¨‹ ğŸƒâ€â¡ï¸

#### ä»ä¼ ç»Ÿæ¶æ„åˆ° monorepo æ¶æ„çš„æ¼”è¿›è·¯å¾„

**âœ… é˜¶æ®µ 1ï¼šä¼ ç»Ÿæ¶æ„ç—›ç‚¹**

- å¤šé¡¹ç›®ä»£ç æ— æ³•å¤ç”¨ï¼Œå…¬å…±æ¨¡å—éœ€è¦æ‰‹åŠ¨åŒæ­¥

- é¡¹ç›®é—´ä¾èµ–å†²çªå’Œç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜é¢‘å‘

- CI/CD ç®¡ç†å¤æ‚ï¼Œæ¯ä¸ªé¡¹ç›®éœ€è¦å•ç‹¬çš„æµæ°´çº¿

**âœ… é˜¶æ®µ 2ï¼šå¼•å…¥ monorepo**

- ã€Œä»£ç é›†ä¸­åŒ–ã€å°†å¤šä¸ªé¡¹ç›®åˆå¹¶åˆ°ä¸€ä¸ªä»“åº“ï¼Œç»Ÿä¸€ç®¡ç†

- ã€Œå·¥å…·å¼•å…¥ã€é€‰æ‹© pnpm ä½œä¸ºä¾èµ–ç®¡ç†å·¥å…·ï¼Œé…ç½® workspaces

- ã€Œå…¬å…±æ¨¡å—æŠ½ç¦»ã€æå–é¡¹ç›®ä¸­çš„é‡å¤æ¨¡å—ï¼Œä½œä¸ºç‹¬ç«‹çš„å­åŒ…ç®¡ç†

**âœ… é˜¶æ®µ 3ï¼šä¼˜åŒ–å’Œè‡ªåŠ¨åŒ–**

- ã€Œæ„å»ºä¼˜åŒ–ã€ä½¿ç”¨ pnpm çš„ `filter` åŠŸèƒ½å®ç°æŒ‰éœ€æ„å»º

- ã€Œå‘å¸ƒæµç¨‹è‡ªåŠ¨åŒ–ã€å€ŸåŠ© CI/CD æµæ°´çº¿å®ç°å¤šåŒ…çš„è‡ªåŠ¨å‘å¸ƒï¼ˆå¦‚ä½¿ç”¨ Changesetï¼‰

- ã€Œç›‘æ§å’Œæµ‹è¯•ã€å¯¹ monorepo ä¸­çš„æ¯ä¸ªå­åŒ…å¢åŠ ç‹¬ç«‹çš„æµ‹è¯•å’Œè´¨é‡ç›‘æ§

##### å…³é”®æ­¥éª¤

1ï¸âƒ£ é¡¹ç›®è¿ç§» â€”â€” å°†ç°æœ‰ç‹¬ç«‹é¡¹ç›®æ•´åˆåˆ°ç»Ÿä¸€ä»“åº“

2ï¸âƒ£ pnpm é…ç½®

- åˆ›å»º`pnpm-workspace.yaml`æ–‡ä»¶ï¼ŒæŒ‡å®šå·¥ä½œç©ºé—´è·¯å¾„
- åœ¨æ¯ä¸ªå­åŒ…ä¸­ç»´æŠ¤ç‹¬ç«‹çš„`package.json`

3ï¸âƒ£ ä¾èµ–ç®¡ç† â€”â€” ä½¿ç”¨`pnpm add`å®‰è£…ä¾èµ–ï¼Œæ”¯æŒè·¨åŒ…å…±äº«

4ï¸âƒ£ ç»Ÿä¸€è„šæœ¬ â€”â€” é€šè¿‡æ ¹ç›®å½•çš„`package.json`ç»Ÿä¸€ç®¡ç†æ„å»ºã€æµ‹è¯•ç­‰è„šæœ¬

5ï¸âƒ£ å·¥å…·é“¾å¼•å…¥ â€”â€” é›†æˆ ESLintã€Prettierã€Husky ç­‰å·¥å…·ï¼Œè§„èŒƒä»£ç 

### åŸºæœ¬åŸç† ğŸ””

#### å·¥ä½œç©ºé—´ï¼ˆworkspacesï¼‰

**å®šä¹‰**

- é€šè¿‡`pnpm-workspace.yaml`æ–‡ä»¶æŒ‡å®šå¤šä¸ªå­åŒ…è·¯å¾„ï¼Œpnpm ä¼šå°†è¿™äº›å­åŒ…è¯†åˆ«ä¸ºå·¥ä½œç©ºé—´

**åŠŸèƒ½**

- å­åŒ…ä¹‹é—´å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¬¦å·é“¾æ¥å¼•ç”¨
- æ‰€æœ‰ä¾èµ–é›†ä¸­åœ¨æ ¹ç›®å½•çš„`node_modules`ï¼Œå‡å°‘å®‰è£…é‡

#### ä¾èµ–ç®¡ç†åŸç†

> [!important] å»é‡æœºåˆ¶
> pnpm ä½¿ç”¨å…¨å±€ç¼“å­˜å­˜å‚¨ä¾èµ–ï¼Œé¿å…é‡å¤å®‰è£…

> [!important] è½¯é“¾æ¥æœºåˆ¶
> å­åŒ…ä¸­ä¾èµ–çš„æ¨¡å—é€šè¿‡è½¯é“¾æ¥åˆ°æ ¹ç›®å½•çš„`node_modules`ï¼Œå®ç°å¿«é€Ÿå¼•ç”¨

> [!important] ç‰ˆæœ¬ä¸€è‡´æ€§
> æ ¹ç›®å½•`package.json`çš„ä¾èµ–å¯ä»¥å¼ºåˆ¶ç»Ÿä¸€å­åŒ…ä¾èµ–ç‰ˆæœ¬

#### å­åŒ…æ„å»ºåŸç†

> [!important] å±€éƒ¨æ„å»º
> pnpm æ”¯æŒé€šè¿‡`--filter`å‚æ•°é€‰æ‹©æ€§åœ°æ„å»ºç‰¹å®šå­åŒ…ï¼Œæå‡æ„å»ºæ•ˆç‡

> [!important] ç¼“å­˜åˆ©ç”¨
> å€ŸåŠ© pnpm å’Œæ„å»ºå·¥å…·çš„ç¼“å­˜åŠŸèƒ½ï¼Œé¿å…é‡å¤æ‰“åŒ…

#### å­åŒ…å‘å¸ƒåŸç†ï¼ˆç»“åˆ NX æˆ– Turboï¼‰

**å‘å¸ƒå·¥å…·**

- é€šå¸¸ç»“åˆ Changesetã€Turbo ç­‰å·¥å…·è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œè‡ªåŠ¨å‘å¸ƒ

**æµç¨‹**

1ï¸âƒ£ è¯†åˆ«å­åŒ…æ”¹åŠ¨

2ï¸âƒ£ è‡ªåŠ¨ç”Ÿæˆå˜æ›´æ—¥å¿—

3ï¸âƒ£ æŒ‰å­åŒ…ç”Ÿæˆæ–°ç‰ˆæœ¬å·å¹¶å‘å¸ƒåˆ° npm

### pnpm monorepo çš„ä¼˜åŠ¿

#### ä¼˜åŠ¿å¯¹æ¯”

| ç»´åº¦         | ä¼ ç»Ÿæ¶æ„                     | pnpm monorepo æ¶æ„         |
| ------------ | ---------------------------- | -------------------------- |
| ä¾èµ–ç®¡ç†     | æ¯ä¸ªé¡¹ç›®å•ç‹¬ç®¡ç†ä¾èµ–         | ç»Ÿä¸€ç®¡ç†ä¾èµ–ï¼Œå‡å°‘ç‰ˆæœ¬å†²çª |
| å…¬å…±æ¨¡å—å¤ç”¨ | éœ€è¦æ‰‹åŠ¨åŒæ­¥å’Œå‘å¸ƒ           | å­åŒ…é—´ç›´æ¥å¼•ç”¨ï¼Œå¿«é€Ÿå…±äº«   |
| æ„å»ºæ•ˆç‡     | æ¯ä¸ªé¡¹ç›®å•ç‹¬æ„å»ºï¼Œè€—æ—¶é•¿     | æŒ‰éœ€æ„å»ºï¼Œæå‡æ•ˆç‡         |
| ç£ç›˜å ç”¨     | é‡å¤å®‰è£…ï¼Œç£ç›˜å ç”¨é«˜         | å»é‡æœºåˆ¶ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´     |
| åä½œæˆæœ¬     | è·¨é¡¹ç›®åä½œå¤æ‚ï¼Œæµ‹è¯•è”è°ƒè€—æ—¶ | å•ä»“åº“é›†ä¸­ç®¡ç†ï¼Œä¾¿äºåä½œ   |

#### é€‚ç”¨åœºæ™¯

> [!tip] å¤šæ¨¡å—é¡¹ç›®
> å¦‚å‰ç«¯ç»„ä»¶åº“ã€å·¥å…·å‡½æ•°åº“

> [!tip] å¾®å‰ç«¯æ¶æ„
> å¤šä¸ªå‰ç«¯é¡¹ç›®æ•´åˆä¸ºä¸€ä¸ª monorepo

> [!tip] å¤æ‚åç«¯æœåŠ¡
> å¤šä¸ªå¾®æœåŠ¡çš„ç»Ÿä¸€ç®¡ç†å’Œéƒ¨ç½²

> [!important] æ€»ç»“
> ä¼ ç»Ÿæ¶æ„å­˜åœ¨ä¾èµ–ç®¡ç†å›°éš¾ã€ä»£ç å¤ç”¨æ€§ä½ç­‰é—®é¢˜ï¼Œpnpm monorepo æ¶æ„é€šè¿‡ç»Ÿä¸€ç®¡ç†ä¾èµ–å’Œä»£ç ï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡å’Œåä½œä½“éªŒ
>
> æ¶æ„è¿ç§»è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„å·¥å…·é“¾é…ç½®ã€ä¾èµ–å†²çªè§£å†³ä»¥åŠæ„å»ºå’Œå‘å¸ƒä¼˜åŒ–

## ç³»ç»Ÿå·¥ç¨‹åŒ–åŸºäº monorepo æ¶æ„è®¾è®¡æœ‰ä»€ä¹ˆå®è·µç»éªŒ

### å‰ç«¯å›¢é˜Ÿç°çŠ¶ä¸æŒ‘æˆ˜

åœ¨å¤§å‹å›¢é˜Ÿå¼€å‘ä¸­ï¼Œç»„ä»¶åº“ã€è„šæ‰‹æ¶å’Œä¸šåŠ¡ç³»ç»Ÿæ˜¯å¸¸è§çš„æ ¸å¿ƒæ¨¡å—ï¼Œå®ƒä»¬é€šå¸¸å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹

- **ç»„ä»¶åº“**ï¼šæä¾›å¤ç”¨çš„ UI ç»„ä»¶æˆ–å·¥å…·å‡½æ•°ï¼Œç”¨äºåŠ é€Ÿä¸šåŠ¡å¼€å‘

- **è„šæ‰‹æ¶**ï¼šç”¨äºå¿«é€Ÿåˆ›å»ºæ–°é¡¹ç›®æˆ–æ¨¡å—ï¼Œæ ‡å‡†åŒ–é¡¹ç›®ç»“æ„å’Œé…ç½®

- **ä¸šåŠ¡ç³»ç»Ÿ**ï¼šä½œä¸ºé¢å‘æœ€ç»ˆç”¨æˆ·çš„æ ¸å¿ƒç³»ç»Ÿï¼Œé€šå¸¸ä¾èµ–ç»„ä»¶åº“å’Œè„šæ‰‹æ¶

è¿™äº›æ¨¡å—åœ¨åˆ†å¸ƒå¼å¼€å‘ä¸­å­˜åœ¨ä»¥ä¸‹é—®é¢˜

- **ä¾èµ–ç®¡ç†å›°éš¾**ï¼šç»„ä»¶åº“ç‰ˆæœ¬æ›´æ–°åï¼Œä¸šåŠ¡ç³»ç»Ÿå’Œè„šæ‰‹æ¶çš„åŒæ­¥éš¾ä»¥ä¿è¯

- **é‡å¤æ„å»º**ï¼šä¸åŒæ¨¡å—éœ€è¦ç‹¬ç«‹æ„å»ºï¼Œæ•ˆç‡ä½ä¸‹

- **ç‰ˆæœ¬å†²çª**ï¼šå„æ¨¡å—ä¾èµ–çš„åº“ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå®¹æ˜“å¯¼è‡´å†²çª

- **åä½œå¤æ‚**ï¼šè·¨æ¨¡å—è°ƒè¯•å’Œè”è°ƒéœ€è¦é¢å¤–çš„æ—¶é—´æˆæœ¬

### å¼•å…¥ monorepo æ¶æ„

**è§£å†³æ–¹æ¡ˆæ¦‚è¿°**

monorepo æ˜¯ä¸€ç§å°†å¤šä¸ªç›¸å…³é¡¹ç›®å­˜å‚¨åœ¨åŒä¸€ä¸ªä»£ç ä»“åº“ä¸­çš„ç®¡ç†æ–¹å¼ï¼Œç»“åˆ pnpmã€turboã€tsup å’Œ vite ç­‰å·¥å…·ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³ä¸Šè¿°é—®é¢˜

- **ç»Ÿä¸€ä¾èµ–ç®¡ç†**ï¼šé€šè¿‡ pnpm çš„ workspace åŠŸèƒ½ï¼Œæ‰€æœ‰å­åŒ…å…±äº«ä¾èµ–ï¼Œé¿å…ç‰ˆæœ¬å†²çª

- **é«˜æ•ˆæ„å»ºä¸è°ƒè¯•**ï¼šåˆ©ç”¨ turbo æŒ‰éœ€æ„å»ºï¼Œæ˜¾è‘—æå‡æ•ˆç‡

- **æ¨¡å—åŒ–ç®¡ç†**ï¼šç»„ä»¶åº“ã€è„šæ‰‹æ¶å’Œä¸šåŠ¡ç³»ç»Ÿé€šè¿‡æ¸…æ™°çš„åˆ†åŒ…ç»“æ„å®ç°ç‹¬ç«‹å¼€å‘ä¸åä½œ

**æ¶æ„ç¤ºæ„**

```
root
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ ui             # ç»„ä»¶åº“
â”‚   â”œâ”€â”€ cli            # è„šæ‰‹æ¶
â”‚   â””â”€â”€ apps
â”‚       â””â”€â”€ business-system  # ä¸šåŠ¡ç³»ç»Ÿ
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ turbo.json
```

### ä¾èµ–ç®¡ç†ä¸ workspace é…ç½®

**pnpm workspace é…ç½®**

pnpm çš„ workspace æä¾›äº†å¤šé¡¹ç›®ä¾èµ–ç®¡ç†çš„èƒ½åŠ›ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡`pnpm-workspace.yaml`ç®¡ç†å­åŒ…

**é…ç½®æ­¥éª¤**

1ï¸âƒ£ åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`pnpm-workspace.yaml`æ–‡ä»¶

```yaml
packages:
  - 'packages/*'
  - 'apps/*'
```

2ï¸âƒ£ æ¯ä¸ªå­åŒ…æ‹¥æœ‰ç‹¬ç«‹çš„`package.json`æ–‡ä»¶ï¼Œä¾‹å¦‚

```json
{
  "name": "@zxwin/ui",
  "version": "1.0.0",
  "main": "dist/index.js",
  "dependencies": {}
}
```

3ï¸âƒ£ å®‰è£…å…±äº«ä¾èµ–

```bash
pnpm install
```

**å­åŒ…ä¾èµ–ç®¡ç†**

ä½¿ç”¨ pnpm çš„å·¥ä½œç©ºé—´æœºåˆ¶æ·»åŠ ä¾èµ–

```bash
pnpm add @zxwin/ui --filter @zxwin/business-system
```

å­åŒ…ä¹‹é—´çš„ä¾èµ–é€šè¿‡ç¬¦å·é“¾æ¥å®ç°æœ¬åœ°å¼•ç”¨ï¼Œå‡å°‘é‡å¤å®‰è£…

### å­åŒ…æ„å»ºæ–¹å¼é€‰æ‹©

#### ç»„ä»¶åº“æ„å»ºï¼štsup

Tsup æ˜¯ä¸€ä¸ªé›¶é…ç½®ã€é«˜æ€§èƒ½çš„æ‰“åŒ…å·¥å…·ï¼Œéå¸¸é€‚åˆç»„ä»¶åº“çš„æ„å»ºéœ€æ±‚

**è¯¦ç»†é…ç½®æ­¥éª¤**

1ï¸âƒ£ å®‰è£… tsup

```bash
pnpm add tsup -D
```

2ï¸âƒ£ åœ¨ç»„ä»¶åº“å­åŒ…çš„`package.json`ä¸­æ·»åŠ æ„å»ºè„šæœ¬

```json
{
  "scripts": {
    "build": "tsup src/index.ts --format esm,cjs --dts"
  }
}
```

3ï¸âƒ£ æ‰§è¡Œæ‰“åŒ…

```bash
pnpm build
```

#### ä¸šåŠ¡ç³»ç»Ÿå¼€å‘ä¸æ„å»ºï¼švite

vite æä¾›äº†æå¿«çš„å¼€å‘æœåŠ¡å™¨å’Œé«˜æ•ˆçš„æ„å»ºèƒ½åŠ›ï¼Œéå¸¸é€‚åˆä¸šåŠ¡ç³»ç»Ÿ

**é…ç½®æ­¥éª¤**

1ï¸âƒ£ å®‰è£… vite

```bash
pnpm add vite -D
```

2ï¸âƒ£ åˆ›å»º`vite.config.ts`

```typescript
import { defineConfig } from 'vite'

export default defineConfig({
  root: './',
  server: {
    port: 3000
  },
  build: {
    outDir: 'dist'
  }
})
```

3ï¸âƒ£ å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

#### è„šæ‰‹æ¶æ„å»ºï¼šæŒ‰éœ€ç¼–è¯‘

è„šæ‰‹æ¶å·¥å…·é€šå¸¸åªéœ€æ‰“åŒ…æ ¸å¿ƒé€»è¾‘ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ tsup æˆ–å…¶ä»–å·¥å…·æ‰“åŒ…ä¸º Node.js å¯æ‰§è¡Œæ–‡ä»¶

### åŸºäº turbo çš„æµæ°´çº¿æ„å»ºä¸å¯åŠ¨

#### turbo çš„ä»»åŠ¡ç®¡ç†

> turbo æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„ä»»åŠ¡è¿è¡Œå™¨ï¼Œé€‚åˆ monorepo åœºæ™¯ä¸‹çš„ä»»åŠ¡ç¼–æ’

**é…ç½®æ­¥éª¤**

1ï¸âƒ£ åˆ›å»º`turbo.json`

```json
{
  "pipeline": {
    "build": {
      "outputs": ["dist/**"]
    },
    "dev": {},
    "test": {}
  }
}
```

2ï¸âƒ£ ä½¿ç”¨ turbo æ‰§è¡Œä»»åŠ¡

```bash
turbo run build
```

3ï¸âƒ£ turbo æ”¯æŒè·³è¿‡æœªæ”¹åŠ¨çš„å­åŒ…ä»»åŠ¡ï¼Œæå¤§æå‡æ„å»ºæ•ˆç‡

#### å¹¶è¡Œä¸ä¾èµ–ä»»åŠ¡

é…ç½®ä»»åŠ¡çš„ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚å…ˆæ„å»ºç»„ä»¶åº“å†å¯åŠ¨ä¸šåŠ¡ç³»ç»Ÿ

```json
{
  "pipeline": {
    "dev": {
      "dependsOn": ["build"]
    }
  }
}
```

### å·¥ç¨‹åŒ–è§„èŒƒä¸ä»£ç è´¨é‡ä¿è¯

#### ç»Ÿä¸€ä»£ç è§„èŒƒ

- ESLintï¼šç»Ÿä¸€ä»£ç é£æ ¼å’Œè¯­æ³•æ£€æŸ¥

- Prettierï¼šæ ¼å¼åŒ–ä»£ç ï¼Œæé«˜å¯è¯»æ€§

#### æäº¤è§„èŒƒ

- Commitlintï¼šè§„èŒƒæäº¤ä¿¡æ¯

- é…ç½®`commitlint.config.js`

```javascript
module.exports = { extends: ['@commitlint/config-conventional'] }
```

#### è‡ªåŠ¨åŒ–æ£€æŸ¥

- Huskyï¼šåœ¨ Git é’©å­ä¸­é›†æˆè‡ªåŠ¨æ£€æŸ¥

- é…ç½®é¢„æäº¤æ£€æŸ¥è„šæœ¬

```bash
npx husky add .husky/pre-commit "pnpm lint"
```

## å‰ç«¯åŸºäº monorepo å·¥ç¨‹æ¶æ„æœ€ä½³å®è·µ

> å¯ä»¥å¤šé˜…è¯»å¤§å‚å¼€æºé¡¹ç›®ï¼Œæå‡å·¥ç¨‹åŒ–æ¶æ„è®¾è®¡æ€ç»´

| å…¬å¸ | é¡¹ç›®/æ¨¡å—   | åœ°å€                                                      | ç®€è¦è¯´æ˜                                  |
| ---- | ----------- | --------------------------------------------------------- | ----------------------------------------- |
| é˜¿é‡Œ | Ant Design  | [Ant Design](https://github.com/ant-design/ant-design)    | ä¼ä¸šçº§ UI è®¾è®¡è¯­è¨€ä¸ React ç»„ä»¶åº“         |
| é˜¿é‡Œ | ahooks      | [ahook](https://github.com/alibaba/hooks)                 | é«˜è´¨é‡çš„ React Hooks åº“                   |
| é˜¿é‡Œ | BizCharts   | [bizCharts](https://github.com/alibaba/BizCharts)         | åŸºäº G2 çš„ React æ•°æ®å¯è§†åŒ–åº“             |
| é˜¿é‡Œ | Umi         | [umi](https://github.com/umijs/umi)                       | ä¼ä¸šçº§ React åº”ç”¨æ¡†æ¶ï¼Œæ”¯æŒæ’ä»¶åŒ–æ‰©å±•     |
| é˜¿é‡Œ | Qiankun     | [qiankun](https://github.com/umijs/qiankun)               | å¾®å‰ç«¯æ¡†æ¶ï¼ŒåŸºäº single-spa æ”¹è¿›          |
| å­—èŠ‚ | Arco Design | [arco-design](https://github.com/arco-design/arco-design) | ä¼ä¸šçº§è®¾è®¡ä½“ç³»ä¸ç»„ä»¶åº“ï¼Œæ”¯æŒ React å’Œ Vue |
| å­—èŠ‚ | Semi Design | [semi-design](https://github.com/DouyinFE/semi-design)    | çµæ´»ä¸”æ‰©å±•æ€§å¼ºçš„è®¾è®¡ç³»ç»Ÿ                  |
| å­—èŠ‚ | IconPark    | [icon-park](https://github.com/bytedance/iconpark)        | å¯è‡ªå®šä¹‰å¤šé£æ ¼å›¾æ ‡åº“                      |
| å­—èŠ‚ | VTable      | [VTable](https://github.com/VisActor/VTable)              | é¢å‘å¤§æ•°æ®å±•ç¤ºçš„å¯è§†åŒ–è¡¨æ ¼åº“              |
| å­—èŠ‚ | Garfish     | [garfish](https://github.com/web-infra-dev/garfish)       | å¾®å‰ç«¯æ¡†æ¶ï¼Œæ”¯æŒæ¨¡å—åŒ–åŠ è½½ä¸éš”ç¦»          |
| å­—èŠ‚ | rsbuild     | [rsbuild](https://github.com/web-infra-dev/rsbuild)       | é«˜æ€§èƒ½æ„å»ºå·¥å…·ï¼Œç±»ä¼¼ Vite å’Œ Esbuild      |

### Ant Design

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/001.jpg)

- ä½¿ç”¨`pnpm`ç®¡ç†å¤šåŒ…ä¾èµ–ï¼Œç»Ÿä¸€ç‰ˆæœ¬ï¼Œæå‡åŒ…çš„å‘å¸ƒå’Œæ„å»ºæ•ˆç‡
- å°†æ ¸å¿ƒç»„ä»¶åº“ï¼ˆ`@ant-design/components`ï¼‰ã€æ–‡æ¡£ç«™ç‚¹ã€å·¥å…·åŒ…ï¼ˆå¦‚æ„å»ºè„šæœ¬ã€ä»£ç é£æ ¼æ’ä»¶ï¼‰ç­‰åˆ†ç¦»ä¸ºå¤šä¸ªåŒ…
- é€šè¿‡ä¸¥æ ¼çš„ä¾èµ–å…³ç³»å®šä¹‰å’Œå…±äº«é…ç½®ï¼ˆå¦‚ ESLintã€TSConfigï¼‰ï¼Œç¡®ä¿å¤šåŒ…ä¹‹é—´åä½œçš„å¯é æ€§
- åˆ©ç”¨`lerna`æˆ–`changesets`å®ç°å˜æ›´è®°å½•è‡ªåŠ¨ç”Ÿæˆï¼Œç®¡ç†å¤šä¸ªæ¨¡å—çš„ç‰ˆæœ¬å‘å¸ƒ

### ahooks

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/002.jpg)

- Hooks è¢«æ‹†åˆ†ä¸ºå¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼ˆå¦‚`useRequest`ã€`useDrag`ï¼‰ï¼Œç”¨æˆ·å¯ä»¥æŒ‰éœ€å®‰è£…
- ä½¿ç”¨`pnpm + rollup`å®ç°è½»é‡åŒ–æ„å»ºï¼Œé¿å…é‡å¤ä¾èµ–
- æ–‡æ¡£å’Œæµ‹è¯•ä»£ç ä¸æ ¸å¿ƒä»£ç æ¨¡å—åŒ–ç®¡ç†ï¼Œæ–¹ä¾¿å¼€å‘å’Œç»´æŠ¤

### Umi

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/003.jpg)

- æ ¸å¿ƒæ¡†æ¶ã€æ’ä»¶ç³»ç»Ÿã€æµ‹è¯•å·¥å…·ï¼ˆå¦‚`umi-test`ï¼‰åˆ†æ¨¡å—ç®¡ç†ï¼Œä¿è¯åŠŸèƒ½è§£è€¦
- é€šè¿‡`shared-utils`ç»Ÿä¸€æ ¸å¿ƒå·¥å…·å‡½æ•°ï¼Œé™ä½é‡å¤å®ç°
- æä¾›å®Œå–„çš„è„šæ‰‹æ¶å·¥å…·ï¼Œè‡ªåŠ¨ç”Ÿæˆå¤šæ¨¡å—ä¾èµ–çš„å¼€å‘ç¯å¢ƒ

### Qiankun

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/004.jpg)

- æ ¸å¿ƒåº“ï¼ˆ`qiankun`ï¼‰ã€æµ‹è¯•å·¥å…·ã€ç¤ºä¾‹é¡¹ç›®ï¼ˆexamplesï¼‰ç»Ÿä¸€ç®¡ç†
- ä½¿ç”¨`pnpm`çš„è½¯é“¾æ¥åŠŸèƒ½ï¼Œå°†æœ¬åœ°å¼€å‘åŒ…æ— ç¼é›†æˆåˆ°ç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œæå‡å¼€å‘æ•ˆç‡
- é€šè¿‡æŒç»­é›†æˆå·¥å…·ï¼ˆå¦‚ GitHub Actionsï¼‰è‡ªåŠ¨åŒ–æµ‹è¯•æ‰€æœ‰å­åŒ…ï¼Œç¡®ä¿æ¡†æ¶ç¨³å®šæ€§

### Arco Design

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/005.jpg)

- æ ¸å¿ƒç»„ä»¶ï¼ˆReact/Vueï¼‰ã€ä¸»é¢˜å·¥å…·ã€å›¾æ ‡åº“ç­‰åˆ†ä¸ºå¤šä¸ªå­åŒ…ï¼Œçµæ´»ç»„åˆ
- æä¾›`@arco-dev/cli`ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿç”Ÿæˆç¬¦åˆ monorepo çš„é¡¹ç›®ç»“æ„
- é›†æˆå¤šç§å·¥å…·ï¼ˆå¦‚ Jestã€Storybookï¼‰ï¼Œç»Ÿä¸€æµ‹è¯•å’Œæ–‡æ¡£å¼€å‘æµç¨‹

### Semi Design

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/006.jpg)

- ä½¿ç”¨ Rush æˆ–`pnpm`ç®¡ç†æ¨¡å—ä¾èµ–ï¼Œé¿å…å›¢é˜Ÿåä½œä¸­å‡ºç°ç‰ˆæœ¬ä¸ä¸€è‡´çš„é—®é¢˜
- å°†åŸºç¡€ç»„ä»¶ã€ä¸šåŠ¡ç»„ä»¶ã€è„šæ‰‹æ¶å·¥å…·è§£è€¦ï¼Œæ”¯æŒç”¨æˆ·æŒ‰éœ€å¼•ç”¨å’Œå®šåˆ¶
- å¤šåŒ…å‘å¸ƒä½¿ç”¨`changesets`è‡ªåŠ¨ç”Ÿæˆå˜æ›´æ—¥å¿—ï¼Œé™ä½ç»´æŠ¤æˆæœ¬

### IconPark

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/007.jpg)

- å›¾æ ‡åº“åˆ†ä¸º SVG æ ¸å¿ƒåŒ…ã€React åŒ…ã€Vue åŒ…ç­‰å¤šä¸ªæ¨¡å—ï¼Œé€‚é…ä¸åŒå‰ç«¯æ¡†æ¶
- ä½¿ç”¨`pnpm`çš„ workspace ç‰¹æ€§ï¼Œä¿æŒæ¨¡å—ä¹‹é—´çš„ä¾èµ–åŒæ­¥
- æä¾›ä¸€é”®è„šæ‰‹æ¶å·¥å…·ï¼Œç”Ÿæˆæ–°çš„å›¾æ ‡æ¨¡å—ï¼Œæ–¹ä¾¿ç¤¾åŒºè´¡çŒ®

### VTable

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/008.jpg)

- è¡¨æ ¼æ¸²æŸ“æ ¸å¿ƒä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼Œæ ¸å¿ƒåŠŸèƒ½æ”¯æŒæŒ‰éœ€åŠ è½½
- ä½¿ç”¨`pnpm`å’Œ`eslint-config`ç­‰ç»Ÿä¸€ä»£ç è§„èŒƒ

### Garfish

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/009.jpg)

- æ ¸å¿ƒåº“ä¸æ’ä»¶æ¨¡å—åŒ–æ‹†åˆ†ï¼Œæ–¹ä¾¿æ‰©å±•
- é›†æˆ Lerna å’Œ pnpmï¼Œæå‡ä¾èµ–ç®¡ç†å’Œæ„å»ºé€Ÿåº¦

### rsbuild

[](https://cdn.jsdelivr.net/gh/zxwin0125/image-repo@main/img/knowledge/frontEnd/engineering/architecture/monorepo/010.jpg)

- å­æ¨¡å—æ‹†åˆ†ä¸ºæ ¸å¿ƒæ„å»ºå¼•æ“ã€é€‚é…å™¨ã€å·¥å…·åŒ…ï¼Œä¿æŒçµæ´»æ€§
- åˆ©ç”¨ monorepo ç®¡ç†å¼€å‘ç¯å¢ƒä¾èµ–ï¼Œç»Ÿä¸€ä½¿ç”¨ Rush æå‡æ„å»ºæ•ˆç‡
